
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>demo_script4</title><meta name="generator" content="MATLAB 9.10"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-07-29"><meta name="DC.source" content="demo_script4.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><pre class="codeinput">cdgea; <span class="comment">% set working directory</span>
<span class="comment">% load('example_data/example10xdata2.mat','X','genelist');</span>
[X,genelistx]=sc_readfile(<span class="string">'example_data/GSM3204304_P_P_Expr.csv'</span>);
[Y,genelisty]=sc_readfile(<span class="string">'example_data/GSM3204305_P_N_Expr.csv'</span>);
[X,genelistx]=sc_selectg(X,genelistx,3,1);
[Y,genelisty]=sc_selectg(Y,genelisty,3,1);
[genelist]=intersect(genelistx,genelisty,<span class="string">'stable'</span>);
<span class="comment">% Remove genes encoded in the mitochondrial genome</span>
i=startsWith(genelist,<span class="string">'MT-'</span>);
genelist(i)=[];
[~,i1]=ismember(genelist,genelistx);
[~,i2]=ismember(genelist,genelisty);
X=X(i1,:); genelistx=genelist;
Y=Y(i2,:); genelisty=genelist;
cellidx=[1*ones(size(X,2),1); 2*ones(size(Y,2),1)];
C=sc_cluster_x([X Y],5,<span class="string">'type'</span>,<span class="string">'simlr'</span>);

<span class="comment">% [C,s]=run.SIMLR(X,[]);  % auto-determine the number of clusters.</span>
s=sc_tsne([X Y],2,false,true,false);   <span class="comment">% s=sc_tsne(X,ndim,plotit,donorm,dolog1p);</span>
figure;
scatter(s(:,1),s(:,2),20,C,<span class="string">'filled'</span>)

figure;
scatter(s(:,1),s(:,2),20,cellidx,<span class="string">'filled'</span>)
[X,genelist]=sc_readtsvfile(<span class="string">'example_data/yan.csv'</span>);
t=readtable(<span class="string">'example_data\yan_celltype.txt'</span>);
celltypelist=string(t.cell_type1);
rng(235); showlegend=true;

s=sc_tsne(X,2);
c1=run.SC3(X,6);
c2=run.SIMLR(X,6);
c3=run.SoptSC(X,<span class="string">'k'</span>,6);

<span class="comment">% Result of SC3/R pacakge</span>
load <span class="string">example_data/sc3_results.txt</span>
c0=sc3_results;
Cal_NMI(c0,c1)
Cal_NMI(c0,c2)
Cal_NMI(c0,c3)


fh=figure;
subplot(2,2,1)
gscatter(s(:,1),s(:,2),celltypelist)
<span class="keyword">if</span> showlegend, legend(<span class="string">'Location'</span>,<span class="string">'northwest'</span>); <span class="keyword">else</span>, legend <span class="string">off</span>; <span class="keyword">end</span>
title(<span class="string">'Cell type (''Biological Turth'')'</span>)

subplot(2,2,2)
gscatter(s(:,1),s(:,2),c1)
<span class="keyword">if</span> showlegend, legend(<span class="string">'Location'</span>,<span class="string">'northwest'</span>); <span class="keyword">else</span>, legend <span class="string">off</span>; <span class="keyword">end</span>
title(<span class="string">'SC3'</span>)

subplot(2,2,3)
gscatter(s(:,1),s(:,2),c2)
<span class="keyword">if</span> showlegend, legend(<span class="string">'Location'</span>,<span class="string">'northwest'</span>); <span class="keyword">else</span>, legend <span class="string">off</span>; <span class="keyword">end</span>
title(<span class="string">'SIMLR'</span>)

subplot(2,2,4)
gscatter(s(:,1),s(:,2),c3)
<span class="keyword">if</span> showlegend, legend(<span class="string">'Location'</span>,<span class="string">'northwest'</span>); <span class="keyword">else</span>, legend <span class="string">off</span>; <span class="keyword">end</span>
title(<span class="string">'SoptSC'</span>)
fh.Position=[fh.Position(1) fh.Position(2)-100 fh.Position(3)+100 fh.Position(4)+100];
</pre><pre class="codeoutput">Reading example_data/GSM3204304_P_P_Expr.csv ...... done.
Reading example_data/GSM3204305_P_N_Expr.csv ...... done.
Using 2000 HVGs.
Library-size normalization...done.
Reading example_data/yan.csv ...... done.
Library-size normalization...done.
Log(x+1) transformation...done.
Processing Euclidean distance matrix... 1/3
Calculating cluster array: 100%    [..........]done
Processing Spearman distance matrix... 2/3
Calculating cluster array: 100%    [..........]done
Processing Pearson distance matrix... 3/3
Calculating cluster array: 100%    [..........]done
CLUSTER ENSEMBLES using CSPA
wgraph: writing graph0
 
U:\GitHub\scGEAToolbox\+run\thirdparty\ClusterPack&gt;pmetis graph0 6  
********************************************************************** 
  METIS 3.0   Copyright 1997, Regents of the University of Minnesota 
 
Graph Information --------------------------------------------------- 
  Name: graph0, #Vertices: 90, #Edges: 1347, #Parts: 6 
 
Recursive Partitioning... ------------------------------------------- 
  6-way Edge-Cut: 18003630, Balance:  1.07 
 
Timing Information -------------------------------------------------- 
  I/O:          		   0.009 
  Partitioning: 		   0.001   (PMETIS time) 
  Total:        		   0.010 
********************************************************************** 
sgraph: partgraph1000.bat completed - loading graph0.part.6
clusterensemble: cspa at 0.80911
CLUSTER ENSEMBLES using HGPA
wgraph: writing graph2
wgraph: 90 vertices and 108 non-zero hyperedges
 
U:\GitHub\scGEAToolbox\+run\thirdparty\ClusterPack&gt;shmetis graph2 6 5  
******************************************************************************* 
 HMETIS 1.5.3  Copyright 1998, Regents of the University of Minnesota 
 
HyperGraph Information ----------------------------------------------------- 
 Name: graph2, #Vtxs:    90, #Hedges:   108, #Parts: 6, UBfactor: 0.05 
 Options: HFC, FM, Reconst-False, V-cycles @ End, No Fixed Vertices 
 
Recursive Partitioning... -------------------------------------------------- 
 
  Bisecting a hgraph of size [vertices=90, hedges=108, balance=0.50] 
    The mincut for this bisection = 8888832, (average = 26938099.2) (balance = 0.49) 
 
  Bisecting a hgraph of size [vertices=44, hedges=37, balance=0.33] 
    The mincut for this bisection = 0, (average = 10734499.2) (balance = 0.32) 
 
  Bisecting a hgraph of size [vertices=30, hedges=24, balance=0.50] 
    The mincut for this bisection = 27962784, (average = 28160313.6) (balance = 0.47) 
 
  Bisecting a hgraph of size [vertices=46, hedges=62, balance=0.33] 
    The mincut for this bisection = 6913536, (average = 11759184.0) (balance = 0.35) 
 
  Bisecting a hgraph of size [vertices=30, hedges=43, balance=0.50] 
    The mincut for this bisection = 19629504, (average = 20018390.4) (balance = 0.50) 
 
 -------------------------------------------------------------------------- 
  Summary for the 6-way partition: 
                Hyperedge Cut:  63394656		(minimize) 
      Sum of External Degrees: 126789312		(minimize) 
                  Scaled Cost: 1.88e+004		(minimize) 
                   Absorption:    105.13		(maximize) 
 
      Partition Sizes &amp; External Degrees: 
	    14[6049344]     14[29320800]     16[29444256]     16[13333248]     15[29012160]  
	    15[19629504]  
 
Timing Information --------------------------------------------------------- 
  Partitioning Time:		   0.043sec 
           I/O Time:		   0.021sec 
******************************************************************************* 
sgraph: partgraph0010.bat completed - loading graph2.part.6
clusterensemble: hgpa at 0.80947
CLUSTER ENSEMBLES using MCLA
mcla: preparing graph for meta-clustering
wgraph: writing graph1
 
U:\GitHub\scGEAToolbox\+run\thirdparty\ClusterPack&gt;pmetis graph1 6  
********************************************************************** 
  METIS 3.0   Copyright 1997, Regents of the University of Minnesota 
 
Graph Information --------------------------------------------------- 
  Name: graph1, #Vertices: 108, #Edges: 1265, #Parts: 6 
 
Recursive Partitioning... ------------------------------------------- 
  6-way Edge-Cut: 11486970, Balance:  1.09 
 
Timing Information -------------------------------------------------- 
  I/O:          		   0.022 
  Partitioning: 		   0.000   (PMETIS time) 
  Total:        		   0.022 
********************************************************************** 
sgraph: partgraph0100.bat completed - loading graph1.part.6
clbtocl: delivering 6 clusters
clbtocl: average posterior prob is 0.77949
clusterensemble: mcla at 0.87619
Iter  Err
1, 6.867832
2, 5.876795
3, 5.042887
4, 4.362326
5, 3.807127
6, 3.351183
7, 2.973775
8, 2.658954
9, 0.711817
10, 0.112101
11, 0.103572
12, 0.098797
13, 0.093055
14, 0.087015
15, 0.081145
16, 0.075632
17, 0.070527
18, 0.062194
19, 0.050105
20, 0.034833
21, 0.017597
22, 0.019880

ans =

    0.9398


ans =

    0.8200


ans =

    0.5464

</pre><img vspace="5" hspace="5" src="demo_script4_01.png" alt=""> <img vspace="5" hspace="5" src="demo_script4_02.png" alt=""> <img vspace="5" hspace="5" src="demo_script4_03.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2021a</a><br></p></div><!--
##### SOURCE BEGIN #####
cdgea; % set working directory
% load('example_data/example10xdata2.mat','X','genelist');
[X,genelistx]=sc_readfile('example_data/GSM3204304_P_P_Expr.csv');
[Y,genelisty]=sc_readfile('example_data/GSM3204305_P_N_Expr.csv');
[X,genelistx]=sc_selectg(X,genelistx,3,1);
[Y,genelisty]=sc_selectg(Y,genelisty,3,1);
[genelist]=intersect(genelistx,genelisty,'stable');
% Remove genes encoded in the mitochondrial genome
i=startsWith(genelist,'MT-');
genelist(i)=[];
[~,i1]=ismember(genelist,genelistx);
[~,i2]=ismember(genelist,genelisty);
X=X(i1,:); genelistx=genelist;
Y=Y(i2,:); genelisty=genelist;
cellidx=[1*ones(size(X,2),1); 2*ones(size(Y,2),1)];
C=sc_cluster_x([X Y],5,'type','simlr');

% [C,s]=run.SIMLR(X,[]);  % auto-determine the number of clusters.
s=sc_tsne([X Y],2,false,true,false);   % s=sc_tsne(X,ndim,plotit,donorm,dolog1p);
figure;
scatter(s(:,1),s(:,2),20,C,'filled')

figure;
scatter(s(:,1),s(:,2),20,cellidx,'filled')
[X,genelist]=sc_readtsvfile('example_data/yan.csv');
t=readtable('example_data\yan_celltype.txt');
celltypelist=string(t.cell_type1);
rng(235); showlegend=true;

s=sc_tsne(X,2);
c1=run.SC3(X,6);
c2=run.SIMLR(X,6);
c3=run.SoptSC(X,'k',6);

% Result of SC3/R pacakge
load example_data/sc3_results.txt
c0=sc3_results;
Cal_NMI(c0,c1)
Cal_NMI(c0,c2)
Cal_NMI(c0,c3)


fh=figure; 
subplot(2,2,1)
gscatter(s(:,1),s(:,2),celltypelist)
if showlegend, legend('Location','northwest'); else, legend off; end
title('Cell type (''Biological Turth'')')

subplot(2,2,2)
gscatter(s(:,1),s(:,2),c1)
if showlegend, legend('Location','northwest'); else, legend off; end
title('SC3')

subplot(2,2,3)
gscatter(s(:,1),s(:,2),c2)
if showlegend, legend('Location','northwest'); else, legend off; end
title('SIMLR')

subplot(2,2,4)
gscatter(s(:,1),s(:,2),c3)
if showlegend, legend('Location','northwest'); else, legend off; end
title('SoptSC')
fh.Position=[fh.Position(1) fh.Position(2)-100 fh.Position(3)+100 fh.Position(4)+100];
##### SOURCE END #####
--></body></html>